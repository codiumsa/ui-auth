"use strict";!function(){angular.module("ui.auth",[]),angular.module("ui.auth.directives",[]),angular.module("ui.auth.services",[])}(),function(){function e(e,n){return{restrict:"A",link:function(i,t,r){var o,u,s=void 0!==r.permissions||void 0!==r.requiresLogin,a=e.isLoggedIn(),c=s&&!a;r.whenLogin&&(c=a?"hide"===r.whenLogin:"show"===r.whenLogin),r.permissions&&(o=r.permissions.split(",")),o&&(c=!n.hasPermissions(o)),r.anyPermissions&&(u=r.anyPermissions.split(","),c=!n.hasAnyPermissions(u)),c&&t.remove()}}}angular.module("ui.auth.directives").directive("auth",e),e.$inject=["AuthenticationService","AuthorizationService"]}(),function(){function e(e,n){function i(e,n){var i=new r({grantType:"password",username:e,password:n}),o=i.$save();return o.then(t),o}function t(e){localStorage.setItem(n.preffix,JSON.stringify(e))}var r=e(n.serverURL+"/oauth/token");return{login:i}}angular.module("ui.auth.services").service("AuthenticationService",e),e.$injec=["$resource","AuthConfig"]}(),function(){function e(e,n,i){var t=e(i.serverURL+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,i){var t=i||n.getCurrent(),r=[];return t&&(r=t.permissions||[]),r.indexOf(e.trim())>=0},hasPermissions:function(e,n){for(var i=this,t=!0,r=0;r<e.length;r++)if(!i.hasPermission(e[r],n)){t=!1;break}return t},hasAnyPermissions:function(e,n){var i=this;return _.some(e,function(e){return i.hasPermission(e,n)})},hasRol:function(e,i){var t=i||n.getCurrent(),r=[];return t&&(r=t.rols||[]),r.indexOf(e.trim())>=0},principal:function(){return t.get({action:"principal"}).$promise},authorize:function(e,i){var t=n.getCurrentUser();if(e===!0&&void 0===t)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==t&&(void 0===i||0===i.length))return this.enums.AUTHORIZED;if(i){var r=this.hasPermissions(i,t);return r?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}angular.module("ui.auth.services").service("AuthorizationService",e),e.$inject=["$resource","AuthenticationService","AuthConfig"]}(),function(){angular.module("ui.auth").provider("AuthConfig",function(){var e={};this.config=function(n){angular.extend(e,n)},this.$get=[function(){return e}]})}(),function(){function e(e,n,i){return{request:function(e){var n=i.get("TokenService"),t=n.getToken();return t&&(e.headers.Authorization="Bearer "+t),e.headers["Content-Type"]="application/json",e},requestError:function(t){var r=i.get("AuthConfig");return 401===t.status&&n.path(r.loginPath),e.reject(t)},response:function(e){return e},responseError:function(t){var r=i.get("AuthConfig"),o=i.get("$window");if(500===t.status&&"POST"===t.config.method&&t.config.url===r.serverURL+"/token"&&(n.path(r.loginPath),o.location.reload()),401===t.status){if(t.data&&403===t.data.code)return n.path("/"),e.reject(t);if(n.path()===r.loginPath)return e.reject(t)}return e.reject(t)}}}angular.module("ui.auth.services").factory("HttpInterceptor",e),e.$inject=["$q","$location","$injector"]}();