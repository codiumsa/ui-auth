!function(){"use strict";angular.module("ui.auth",["ui"]),angular.module("ui.auth.directives",[]),angular.module("ui.auth.services",[])}(),function(){"use strict";function e(e,r){return{restrict:"A",link:function(t,n,i){var s,o,u=void 0!==i.permissions||void 0!==i.requiresLogin,a=e.isLoggedIn(),c=u&&!a;i.whenLogin&&(c=a?"hide"===i.whenLogin:"show"===i.whenLogin),i.permissions&&(s=i.permissions.split(",")),s&&(c=!r.hasPermissions(s)),i.anyPermissions&&(o=i.anyPermissions.split(","),c=!r.hasAnyPermissions(o)),c&&n.remove()}}}angular.module("ui.auth.directives").directive("auth",e),e.$inject=["AuthenticationService","AuthorizationService"]}(),function(){"use strict";function e(e,r){function t(e,r){var t=new i({grantType:"password",username:e,password:r}),s=t.$save();return s.then(n),s}function n(e){localStorage.setItem(r.preffix,JSON.stringify(e))}var i=e(r.serverURL+"/oauth/token");return{login:t}}angular.module("ui.auth.services").service("AuthenticationService",e),e.$injec=["$resource","AuthConfig"]}(),function(){"use strict";function e(e,r,t){var n=e(t.serverURL+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,t){var n=t||r.getCurrent(),i=[];return n&&(i=n.permissions||[]),i.indexOf(e.trim())>=0},hasPermissions:function(e,r){for(var t=this,n=!0,i=0;i<e.length;i++)if(!t.hasPermission(e[i],r)){n=!1;break}return n},hasAnyPermissions:function(e,r){var t=this;return _.some(e,function(e){return t.hasPermission(e,r)})},hasRol:function(e,t){var n=t||r.getCurrent(),i=[];return n&&(i=n.rols||[]),i.indexOf(e.trim())>=0},principal:function(){return n.get({action:"principal"}).$promise},authorize:function(e,t){var n=r.getCurrentUser();if(e===!0&&void 0===n)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==n&&(void 0===t||0===t.length))return this.enums.AUTHORIZED;if(t){var i=this.hasPermissions(t,n);return i?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}angular.module("ui.auth.services").service("AuthorizationService",e),e.$inject=["$resource","AuthenticationService","AuthConfig"]}(),function(){"use strict";angular.module("ui.auth").provider("AuthConfig",function(){var e={};this.config=function(r){angular.extend(e,r)},this.$get=[function(){return e}]})}(),function(){"use strict";function e(e,r,t,n){return{request:function(e){return"/ingresar"!==r.path()&&t.AuthParams&&(e.headers.Authorization="Bearer "+t.AuthParams.accessToken),e},requestError:function(t){return 401===t.status&&r.path("/ingresar"),e.reject(t)},response:function(e){return e},responseError:function(i){var s=n.get("ngNotify"),o=n.get("Config"),u=n.get("$window");if(500===i.status&&"POST"===i.config.method&&i.config.url.endsWith("rest/token")&&(localStorage.removeItem(o.authParamsKey),r.path("/"),u.location.reload()),401===i.status){if(i.data&&403===i.data.code)return s.set(i.data.error,"error"),r.path("/"),e.reject(i);if("/ingresar"===r.path())return e.reject(i);var a=e.defer(),c=n.get("AuthenticationService"),h=n.get("$http");console.log(t.AuthParams);var f=c.token(t.AuthParams);return f.then(function(e){t.AuthParams.accessToken=e.accessToken,localStorage.setItem(o.authParamsKey,JSON.stringify(t.AuthParams)),h.defaults.headers.common.Authorization="Bearer "+e.accessToken}).then(a.resolve,a.reject),a.promise.then(function(){return i.config.headers.Authorization="Bearer "+t.AuthParams.accessToken,h(i.config)})}return e.reject(i)}}}angular.module("ui.auth.services").factory("HttpInterceptor",e),e.$inject=["$q","$location","$rootScope","$injector"]}();