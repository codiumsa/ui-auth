"use strict";!function(){angular.module("ui.auth",[]),angular.module("ui.auth.directives",[]),angular.module("ui.auth.services",[])}(),function(){function e(e,n){return{restrict:"A",link:function(r,t,i){var o,u,s=void 0!==i.permissions||void 0!==i.requiresLogin,a=e.isLoggedIn(),c=s&&!a;i.whenLogin&&(c=a?"hide"===i.whenLogin:"show"===i.whenLogin),i.permissions&&(o=i.permissions.split(",")),o&&(c=!n.hasPermissions(o)),i.anyPermissions&&(u=i.anyPermissions.split(","),c=!n.hasAnyPermissions(u)),c&&t.remove()}}}angular.module("ui.auth.directives").directive("auth",e),e.$inject=["AuthenticationService","AuthorizationService"]}(),function(){function e(e,n){function r(e,n){var r=new o({grantType:"password",username:e,password:n}),t=r.$save();return t.then(i),t}function t(e){var n=new o({grantType:"refresh_token",refreshToken:e}),r=n.$save();return r.then(i),r}function i(e){localStorage.setItem(n.preffix,JSON.stringify(e))}var o=e(n.serverURL+"/oauth/token");return{login:r,refresh:t}}angular.module("ui.auth.services").service("AuthenticationService",e),e.$injec=["$resource","AuthConfig"]}(),function(){function e(e,n,r){var t=e(r.serverURL+"/authorization/:action",{action:"@action"});return{hasPermission:function(e,r){var t=r||n.getCurrent(),i=[];return t&&(i=t.permissions||[]),i.indexOf(e.trim())>=0},hasPermissions:function(e,n){for(var r=this,t=!0,i=0;i<e.length;i++)if(!r.hasPermission(e[i],n)){t=!1;break}return t},hasAnyPermissions:function(e,n){var r=this;return _.some(e,function(e){return r.hasPermission(e,n)})},hasRol:function(e,r){var t=r||n.getCurrent(),i=[];return t&&(i=t.rols||[]),i.indexOf(e.trim())>=0},principal:function(){return t.get({action:"principal"}).$promise},authorize:function(e,r){var t=n.getCurrentUser();if(e===!0&&void 0===t)return this.enums.LOGIN_REQUIRED;if(e&&void 0!==t&&(void 0===r||0===r.length))return this.enums.AUTHORIZED;if(r){var i=this.hasPermissions(r,t);return i?this.enums.AUTHORIZED:this.enums.NOT_AUTHORIZED}},enums:{LOGIN_REQUIRED:"loginRequired",NOT_AUTHORIZED:"notAuthorized",AUTHORIZED:"authorized"}}}angular.module("ui.auth.services").service("AuthorizationService",e),e.$inject=["$resource","AuthenticationService","AuthConfig"]}(),function(){angular.module("ui.auth").provider("AuthConfig",function(){var e={};this.config=function(n){angular.extend(e,n)},this.$get=[function(){return e}]})}(),function(){function e(e,n,r){return{request:function(e){var n=r.get("TokenService"),t=n.getToken();return t&&(e.headers.Authorization="Bearer "+t),e.headers["Content-Type"]="application/json",e},requestError:function(t){var i=r.get("AuthConfig");return 401===t.status&&n.path(i.loginPath),e.reject(t)},response:function(e){return e},responseError:function(t){var i=r.get("AuthConfig"),o=r.get("$window"),u=r.get("$http");if(500===t.status&&"POST"===t.config.method&&t.config.url===i.serverURL+"/token"&&(n.path(i.loginPath),o.location.reload()),401===t.status){if(t.data&&403===t.data.code)return n.path("/"),e.reject(t);if(n.path()===i.loginPath)return e.reject(t);var s=e.defer(),a=r.get("AuthenticationService"),c=r.get("TokenService"),h=a.refresh(c.getRefreshToken());return h.then(function(e){return c.setToken(e),e}),h.then(s.resolve,s.reject),s.promise.then(function(){return u(t.config)})}return e.reject(t)}}}angular.module("ui.auth.services").factory("HttpInterceptor",e),e.$inject=["$q","$location","$injector"]}();